// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_CONNECTION_URI")
}

enum InstanceConnectionStatus {
  open
  close
  connecting
}

enum DeviceMessage {
  ios
  android
  web
  unknown
  desktop
}

model Instance {
  id                      String                   @id @default(cuid())
  name                    String                   @unique @db.VarChar(255)
  connectionStatus        InstanceConnectionStatus @default(open)
  ownerJid                String?                  @db.VarChar(100)
  profileName             String?                  @db.VarChar(100)
  profilePicUrl           String?                  @db.VarChar(500)
  integration             String?                  @db.VarChar(100)
  number                  String?                  @db.VarChar(100)
  businessId              String?                  @db.VarChar(100)
  token                   String?                  @db.VarChar(255)
  clientName              String?                  @db.VarChar(100)
  disconnectionReasonCode Int?                     @db.Integer
  disconnectionObject     Json?                    @db.JsonB
  disconnectionAt         DateTime?                @db.Timestamp
  createdAt               DateTime?                @default(now()) @db.Timestamp
  updatedAt               DateTime?                @updatedAt @db.Timestamp
  Chat                    Chat[]
  Contact                 Contact[]
  Message                 Message[]
  Webhook                 Webhook?
  Label                   Label[]
  Proxy                   Proxy?
  Setting                 Setting?
  Rabbitmq                Rabbitmq?
  Nats                    Nats?
  Sqs                     Sqs?
  Kafka                   Kafka?
  Websocket               Websocket?
  Session                 Session?
  MessageUpdate           MessageUpdate[]
  Media                   Media[]
  Template                Template[]
  Pusher                  Pusher?

  @@map("evo_Instance")
}

model OmniGlobalSettings {
  id               Int      @id @default(autoincrement()) @map("id")
  key              String   @db.VarChar(255) @map("key")
  value            String?  @db.Text @map("value")
  valueType        String   @db.VarChar(20) @default("string") @map("value_type")
  category         String?  @db.VarChar(255) @map("category")
  description      String?  @db.Text @map("description")
  isSecret         Boolean  @default(false) @db.Boolean @map("is_secret")
  isRequired       Boolean  @default(false) @db.Boolean @map("is_required")
  defaultValue     String?  @db.Text @map("default_value")
  validationRules  String?  @db.Text @map("validation_rules")
  createdAt        DateTime @default(now()) @db.Timestamp @map("created_at")
  updatedAt        DateTime @default(now()) @db.Timestamp @map("updated_at")
  createdBy        String?  @db.VarChar(255) @map("created_by")
  updatedBy        String?  @db.VarChar(255) @map("updated_by")

  @@map("omni_global_settings")
  @@unique([key], map: "ix_omni_global_settings_key")
  @@index([category], map: "ix_omni_global_settings_category")
}

model OmniSettingChangeHistory {
  id           Int      @id @default(autoincrement()) @map("id")
  settingId    Int      @map("setting_id")
  oldValue     String?  @db.Text @map("old_value")
  newValue     String?  @db.Text @map("new_value")
  changedBy    String?  @db.VarChar(255) @map("changed_by")
  changedAt    DateTime @default(now()) @db.Timestamp @map("changed_at")
  changeReason String?  @db.Text @map("change_reason")

  @@map("omni_setting_change_history")
  @@index([settingId], map: "ix_omni_setting_change_history_setting_id")
  @@index([changedAt], map: "ix_omni_setting_change_history_changed_at")
}

model OmniAgentProviders {
  id               Int       @id @default(autoincrement()) @map("id")
  name             String    @db.VarChar(255) @map("name")
  apiUrl           String    @db.Text @map("api_url")
  apiKey           String    @db.Text @map("api_key")
  description      String?   @db.Text @map("description")
  isActive         Boolean   @default(true) @db.Boolean @map("is_active")
  lastHealthCheck  DateTime? @db.Timestamp @map("last_health_check")
  lastHealthStatus String?   @db.VarChar(20) @map("last_health_status")
  createdAt        DateTime  @default(now()) @db.Timestamp @map("created_at")
  updatedAt        DateTime  @default(now()) @db.Timestamp @map("updated_at")

  instances OmniInstanceConfigs[]

  @@map("omni_agent_providers")
  @@unique([name], map: "ix_omni_agent_providers_name")
  @@index([isActive], map: "ix_omni_agent_providers_is_active")
}

model OmniInstanceConfigs {
  id                        Int      @id @default(autoincrement()) @map("id")
  name                      String   @db.VarChar(255) @map("name")
  channelType               String   @db.VarChar(50) @default("whatsapp") @map("channel_type")
  evolutionUrl              String?  @db.Text @map("evolution_url")
  evolutionKey              String?  @db.Text @map("evolution_key")
  whatsappInstance          String?  @db.VarChar(255) @map("whatsapp_instance")
  sessionIdPrefix           String?  @db.VarChar(255) @map("session_id_prefix")
  webhookBase64             Boolean  @default(true) @db.Boolean @map("webhook_base64")
  discordBotToken           String?  @db.Text @map("discord_bot_token")
  discordClientId           String?  @db.Text @map("discord_client_id")
  discordGuildId            String?  @db.Text @map("discord_guild_id")
  discordDefaultChannelId   String?  @db.Text @map("discord_default_channel_id")
  discordVoiceEnabled       Boolean? @default(false) @db.Boolean @map("discord_voice_enabled")
  discordSlashCommandsEnabled Boolean? @default(true) @db.Boolean @map("discord_slash_commands_enabled")
  discordWebhookUrl         String?  @db.Text @map("discord_webhook_url")
  discordPermissions        Int?     @map("discord_permissions")
  agentProviderId           Int?     @map("agent_provider_id")
  agentApiUrl               String?  @db.Text @map("agent_api_url")
  agentApiKey               String?  @db.Text @map("agent_api_key")
  agentId                   String?  @db.VarChar(255) @default("default") @map("agent_id")
  agentType                 String   @db.VarChar(50) @default("agent") @map("agent_type")
  agentTimeout              Int?     @default(60) @map("agent_timeout")
  agentStreamMode           Boolean  @default(false) @db.Boolean @map("agent_stream_mode")
  profileName               String?  @db.VarChar(255) @map("profile_name")
  profilePicUrl             String?  @db.Text @map("profile_pic_url")
  ownerJid                  String?  @db.VarChar(255) @map("owner_jid")
  isDefault                 Boolean? @default(false) @db.Boolean @map("is_default")
  isActive                  Boolean? @default(false) @db.Boolean @map("is_active")
  enableAutoSplit           Boolean  @default(true) @db.Boolean @map("enable_auto_split")
  messageDebounceSeconds    Int      @default(0) @map("message_debounce_seconds")
  disableUsernamePrefix     Boolean  @default(false) @db.Boolean @map("disable_username_prefix")
  createdAt                 DateTime @default(now()) @db.Timestamp @map("created_at")
  updatedAt                 DateTime @default(now()) @db.Timestamp @map("updated_at")

  agentProvider OmniAgentProviders? @relation(fields: [agentProviderId], references: [id], onDelete: SetNull)

  @@map("omni_instance_configs")
  @@unique([name], map: "ix_omni_instance_configs_name")
  @@index([isDefault], map: "ix_omni_instance_configs_is_default")
  @@index([isActive], map: "ix_omni_instance_configs_is_active")
  @@index([channelType], map: "ix_omni_instance_configs_channel_type")
  @@index([agentProviderId], map: "ix_omni_instance_configs_agent_provider_id")
}

model OmniUsers {
  id                       String   @id @map("id")
  phoneNumber              String   @db.VarChar(255) @map("phone_number")
  whatsappJid              String   @db.VarChar(255) @map("whatsapp_jid")
  instanceName             String   @db.VarChar(255) @map("instance_name")
  displayName              String?  @db.VarChar(255) @map("display_name")
  lastSessionNameInteraction String? @db.VarChar(255) @map("last_session_name_interaction")
  lastAgentUserId          String?  @db.VarChar(255) @map("last_agent_user_id")
  lastSeenAt               DateTime? @db.Timestamp @default(now()) @map("last_seen_at")
  messageCount             Int?     @default(0) @map("message_count")
  createdAt                DateTime? @db.Timestamp @default(now()) @map("created_at")
  updatedAt                DateTime? @db.Timestamp @default(now()) @map("updated_at")

  @@map("omni_users")
  @@index([phoneNumber], map: "ix_omni_users_phone_number")
  @@index([whatsappJid], map: "ix_omni_users_whatsapp_jid")
  @@index([instanceName], map: "ix_omni_users_instance_name")
  @@index([lastSessionNameInteraction], map: "ix_omni_users_last_session_name_interaction")
  @@index([lastSeenAt], map: "ix_omni_users_last_seen_at")
}

model OmniUserExternalIds {
  id           Int      @id @default(autoincrement()) @map("id")
  userId       String   @db.VarChar(255) @map("user_id")
  provider     String   @db.VarChar(255) @map("provider")
  externalId   String   @db.VarChar(255) @map("external_id")
  instanceName String?  @db.VarChar(255) @map("instance_name")
  createdAt    DateTime @default(now()) @db.Timestamp @map("created_at")
  updatedAt    DateTime @default(now()) @db.Timestamp @map("updated_at")

  @@map("omni_user_external_ids")
  @@unique([provider, externalId, instanceName], map: "uq_user_external_provider_instance")
  @@index([userId], map: "ix_omni_user_external_ids_user_id")
  @@index([provider], map: "ix_omni_user_external_ids_provider")
  @@index([externalId], map: "ix_omni_user_external_ids_external_id")
  @@index([instanceName], map: "ix_omni_user_external_ids_instance_name")
}

model OmniAccessRules {
  id           Int       @id @default(autoincrement()) @map("id")
  instanceName String?   @db.VarChar(255) @map("instance_name")
  phoneNumber  String    @db.VarChar(255) @map("phone_number")
  ruleType     String    @db.VarChar(10) @map("rule_type")
  createdAt    DateTime? @default(now()) @db.Timestamp @map("created_at")
  updatedAt    DateTime? @default(now()) @db.Timestamp @map("updated_at")

  @@map("omni_access_rules")
  @@unique([instanceName, phoneNumber, ruleType], map: "uq_access_rules_scope_phone_rule")
  @@index([instanceName], map: "ix_omni_access_rules_instance_name")
  @@index([phoneNumber], map: "ix_omni_access_rules_phone_number")
}

model OmniMessageTraces {
  traceId                   String   @id @map("trace_id")
  instanceName              String?  @db.VarChar(255) @map("instance_name")
  whatsappMessageId         String?  @db.VarChar(255) @map("whatsapp_message_id")
  senderPhone               String?  @db.VarChar(255) @map("sender_phone")
  senderName                String?  @db.VarChar(255) @map("sender_name")
  senderJid                 String?  @db.VarChar(255) @map("sender_jid")
  messageType               String?  @db.VarChar(255) @map("message_type")
  hasMedia                  Boolean? @default(false) @db.Boolean @map("has_media")
  hasQuotedMessage          Boolean? @default(false) @db.Boolean @map("has_quoted_message")
  messageLength             Int?     @map("message_length")
  sessionName               String?  @db.VarChar(255) @map("session_name")
  agentSessionId            String?  @db.VarChar(255) @map("agent_session_id")
  receivedAt                DateTime? @db.Timestamp @default(now()) @map("received_at")
  processingStartedAt       DateTime? @db.Timestamp @map("processing_started_at")
  agentRequestAt            DateTime? @db.Timestamp @map("agent_request_at")
  agentResponseAt           DateTime? @db.Timestamp @map("agent_response_at")
  evolutionSendAt           DateTime? @db.Timestamp @map("evolution_send_at")
  completedAt               DateTime? @db.Timestamp @map("completed_at")
  status                    String?  @db.VarChar(255) @default("received") @map("status")
  errorMessage              String?  @db.Text @map("error_message")
  errorStage                String?  @db.VarChar(255) @map("error_stage")
  blockedByAccessRule       Boolean? @default(false) @db.Boolean @map("blocked_by_access_rule")
  accessRuleId              Int?     @map("access_rule_id")
  blockingReason            String?  @db.Text @map("blocking_reason")
  agentProcessingTimeMs     Int?     @map("agent_processing_time_ms")
  totalProcessingTimeMs     Int?     @map("total_processing_time_ms")
  agentRequestTokens        Int?     @map("agent_request_tokens")
  agentResponseTokens       Int?     @map("agent_response_tokens")
  agentResponseSuccess      Boolean? @db.Boolean @map("agent_response_success")
  agentResponseLength       Int?     @map("agent_response_length")
  agentToolsUsed            Int?     @default(0) @map("agent_tools_used")
  evolutionResponseCode     Int?     @map("evolution_response_code")
  evolutionSuccess          Boolean? @db.Boolean @map("evolution_success")

  @@map("omni_message_traces")
  @@index([instanceName], map: "ix_omni_message_traces_instance_name")
  @@index([whatsappMessageId], map: "ix_omni_message_traces_whatsapp_message_id")
  @@index([senderPhone], map: "ix_omni_message_traces_sender_phone")
  @@index([sessionName], map: "ix_omni_message_traces_session_name")
  @@index([receivedAt], map: "ix_omni_message_traces_received_at")
  @@index([status], map: "ix_omni_message_traces_status")
  @@index([blockedByAccessRule], map: "ix_omni_message_traces_blocked_by_access_rule")
}

model OmniTracePayloads {
  id                   Int      @id @default(autoincrement()) @map("id")
  traceId              String?  @db.VarChar(255) @map("trace_id")
  stage                String?  @db.VarChar(255) @map("stage")
  payloadType          String?  @db.VarChar(255) @map("payload_type")
  payloadCompressed    String?  @db.Text @map("payload_compressed")
  payloadSizeOriginal  Int?     @map("payload_size_original")
  payloadSizeCompressed Int?    @map("payload_size_compressed")
  timestamp            DateTime? @db.Timestamp @default(now()) @map("timestamp")
  statusCode           Int?     @map("status_code")
  errorDetails         String?  @db.Text @map("error_details")
  containsMedia        Boolean? @default(false) @db.Boolean @map("contains_media")
  containsBase64       Boolean? @default(false) @db.Boolean @map("contains_base64")

  @@map("omni_trace_payloads")
  @@index([traceId], map: "ix_omni_trace_payloads_trace_id")
  @@index([stage], map: "ix_omni_trace_payloads_stage")
  @@index([timestamp], map: "ix_omni_trace_payloads_timestamp")
}

model OmniMediaContent {
  id                    Int       @id @default(autoincrement()) @map("id")
  instanceName          String    @db.VarChar(255) @map("instance_name")
  channelType           String    @db.VarChar(20) @map("channel_type")
  originalMessageId     String    @db.VarChar(255) @map("original_message_id")
  senderId              String?   @db.VarChar(255) @map("sender_id")
  contentType           String    @db.VarChar(50) @map("content_type")
  sourceMediaType       String    @db.VarChar(50) @map("source_media_type")
  content               String    @db.Text @map("content")
  contentFormat         String?   @db.VarChar(20) @default("text") @map("content_format")
  processorName         String?   @db.VarChar(100) @map("processor_name")
  processorModel        String?   @db.VarChar(100) @map("processor_model")
  processingTimeMs      Int?      @map("processing_time_ms")
  confidenceScore       Int?      @map("confidence_score")
  // Token/usage tracking
  inputTokens           Int?      @map("input_tokens")
  outputTokens          Int?      @map("output_tokens")
  totalTokens           Int?      @map("total_tokens")
  // Cost tracking (USD)
  costInputUsd          Decimal?  @db.Decimal(10, 8) @map("cost_input_usd")
  costOutputUsd         Decimal?  @db.Decimal(10, 8) @map("cost_output_usd")
  costTotalUsd          Decimal?  @db.Decimal(10, 8) @map("cost_total_usd")
  // Pricing metadata
  pricingModel          String?   @db.VarChar(100) @map("pricing_model")
  pricingRateInput      Decimal?  @db.Decimal(10, 8) @map("pricing_rate_input")
  pricingRateOutput     Decimal?  @db.Decimal(10, 8) @map("pricing_rate_output")
  // Source media info
  mediaUrl              String?   @db.Text @map("media_url")
  mediaMimeType         String?   @db.VarChar(100) @map("media_mime_type")
  mediaSizeBytes        Int?      @map("media_size_bytes")
  mediaDurationSeconds  Int?      @map("media_duration_seconds")
  mediaKey              String?   @db.Text @map("media_key")
  status                String?   @db.VarChar(20) @default("pending") @map("status")
  errorMessage          String?   @db.Text @map("error_message")
  retryCount            Int?      @default(0) @map("retry_count")
  createdAt             DateTime? @db.Timestamp @default(now()) @map("created_at")
  processedAt           DateTime? @db.Timestamp @map("processed_at")

  @@map("omni_media_content")
  @@unique([instanceName, originalMessageId, senderId, contentType], map: "uq_media_content_instance_msg_sender_type")
  @@index([instanceName], map: "ix_omni_media_content_instance")
  @@index([status], map: "ix_omni_media_content_status")
  @@index([contentType], map: "ix_omni_media_content_type")
  @@index([originalMessageId], map: "ix_omni_media_content_message_id")
  @@index([senderId], map: "ix_omni_media_content_sender")
  @@index([createdAt], map: "ix_omni_media_content_created_at")
}

// Batch job tracking for async processing with progress
model OmniBatchJobs {
  jobId           String    @id @map("job_id")
  jobType         String    @db.VarChar(50) @map("job_type")
  instanceName    String?   @db.VarChar(255) @map("instance_name")
  requestParams   String?   @db.Text @map("request_params")
  status          String?   @db.VarChar(20) @default("pending") @map("status")
  totalItems      Int?      @default(0) @map("total_items")
  processedItems  Int?      @default(0) @map("processed_items")
  failedItems     Int?      @default(0) @map("failed_items")
  skippedItems    Int?      @default(0) @map("skipped_items")
  currentItem     String?   @db.VarChar(255) @map("current_item")
  resultsSummary  String?   @db.Text @map("results_summary")
  errorMessage    String?   @db.Text @map("error_message")
  createdAt       DateTime? @db.Timestamp @default(now()) @map("created_at")
  startedAt       DateTime? @db.Timestamp @map("started_at")
  completedAt     DateTime? @db.Timestamp @map("completed_at")
  totalCostUsd    Decimal?  @db.Decimal(10, 8) @map("total_cost_usd")
  totalTokens     Int?      @map("total_tokens")

  @@map("omni_batch_jobs")
  @@index([jobId], map: "ix_omni_batch_jobs_job_id")
  @@index([jobType], map: "ix_omni_batch_jobs_job_type")
  @@index([instanceName], map: "ix_omni_batch_jobs_instance_name")
  @@index([status], map: "ix_omni_batch_jobs_status")
  @@index([createdAt], map: "ix_omni_batch_jobs_created_at")
}

model OmniUserPreferences {
  id        Int      @id @default(autoincrement()) @map("id")
  sessionId String   @db.VarChar(255) @map("session_id")
  key       String   @db.VarChar(100) @map("key")
  value     String?  @db.Text @map("value")
  createdAt DateTime @default(now()) @db.Timestamp @map("created_at")
  updatedAt DateTime @default(now()) @db.Timestamp @map("updated_at")

  @@map("omni_user_preferences")
  @@unique([sessionId, key], map: "uq_user_preferences_session_key")
  @@index([sessionId], map: "ix_omni_user_preferences_session_id")
  @@index([key], map: "ix_omni_user_preferences_key")
}

model Session {
  id        String   @id @default(cuid())
  sessionId String   @unique
  creds     String?  @db.Text
  createdAt DateTime @default(now()) @db.Timestamp
  Instance  Instance @relation(fields: [sessionId], references: [id], onDelete: Cascade)

  @@map("evo_Session")
}

model Chat {
  id             String    @id @default(cuid())
  remoteJid      String    @db.VarChar(100)
  name           String?   @db.VarChar(100)
  labels         Json?     @db.JsonB
  createdAt      DateTime? @default(now()) @db.Timestamp
  updatedAt      DateTime? @updatedAt @db.Timestamp
  Instance       Instance  @relation(fields: [instanceId], references: [id], onDelete: Cascade)
  instanceId     String
  unreadMessages Int       @default(0)

  @@unique([instanceId, remoteJid])
  @@index([instanceId])
  @@index([remoteJid])
  @@map("evo_Chat")
}

model Contact {
  id            String    @id @default(cuid())
  remoteJid     String    @db.VarChar(100)
  pushName      String?   @db.VarChar(100)
  profilePicUrl String?   @db.VarChar(500)
  createdAt     DateTime? @default(now()) @db.Timestamp
  updatedAt     DateTime? @updatedAt @db.Timestamp
  Instance      Instance  @relation(fields: [instanceId], references: [id], onDelete: Cascade)
  instanceId    String

  @@unique([remoteJid, instanceId])
  @@index([remoteJid])
  @@index([instanceId])
  @@map("evo_Contact")
}

model Message {
  id               String          @id @default(cuid())
  key              Json            @db.JsonB
  pushName         String?         @db.VarChar(100)
  participant      String?         @db.VarChar(100)
  messageType      String          @db.VarChar(100)
  message          Json            @db.JsonB
  contextInfo      Json?           @db.JsonB
  source           DeviceMessage
  messageTimestamp Int             @db.Integer
  Instance         Instance        @relation(fields: [instanceId], references: [id], onDelete: Cascade)
  instanceId       String
  MessageUpdate    MessageUpdate[]
  Media            Media?
  webhookUrl       String?         @db.VarChar(500)
  status           String?         @db.VarChar(30)

  @@index([instanceId])
  @@map("evo_Message")
}

model MessageUpdate {
  id          String   @id @default(cuid())
  keyId       String   @db.VarChar(100)
  remoteJid   String   @db.VarChar(100)
  fromMe      Boolean  @db.Boolean
  participant String?  @db.VarChar(100)
  pollUpdates Json?    @db.JsonB
  status      String   @db.VarChar(30)
  Message     Message  @relation(fields: [messageId], references: [id], onDelete: Cascade)
  messageId   String
  Instance    Instance @relation(fields: [instanceId], references: [id], onDelete: Cascade)
  instanceId  String

  @@index([instanceId])
  @@index([messageId])
  @@map("evo_MessageUpdate")
}

model Webhook {
  id              String    @id @default(cuid())
  url             String    @db.VarChar(500)
  headers         Json?     @db.JsonB
  enabled         Boolean?  @default(true) @db.Boolean
  events          Json?     @db.JsonB
  webhookByEvents Boolean?  @default(false) @db.Boolean
  webhookBase64   Boolean?  @default(false) @db.Boolean
  createdAt       DateTime? @default(now()) @db.Timestamp
  updatedAt       DateTime  @updatedAt @db.Timestamp
  Instance        Instance  @relation(fields: [instanceId], references: [id], onDelete: Cascade)
  instanceId      String    @unique

  @@index([instanceId])
  @@map("evo_Webhook")
}

model Label {
  id           String    @id @default(cuid())
  labelId      String?   @db.VarChar(100)
  name         String    @db.VarChar(100)
  color        String    @db.VarChar(100)
  predefinedId String?   @db.VarChar(100)
  createdAt    DateTime? @default(now()) @db.Timestamp
  updatedAt    DateTime  @updatedAt @db.Timestamp
  Instance     Instance  @relation(fields: [instanceId], references: [id], onDelete: Cascade)
  instanceId   String

  @@unique([labelId, instanceId])
  @@map("evo_Label")
}

model Proxy {
  id         String    @id @default(cuid())
  enabled    Boolean   @default(false) @db.Boolean
  host       String    @db.VarChar(100)
  port       String    @db.VarChar(100)
  protocol   String    @db.VarChar(100)
  username   String    @db.VarChar(100)
  password   String    @db.VarChar(100)
  createdAt  DateTime? @default(now()) @db.Timestamp
  updatedAt  DateTime  @updatedAt @db.Timestamp
  Instance   Instance  @relation(fields: [instanceId], references: [id], onDelete: Cascade)
  instanceId String    @unique

  @@map("evo_Proxy")
}

model Setting {
  id              String    @id @default(cuid())
  rejectCall      Boolean   @default(false) @db.Boolean
  msgCall         String?   @db.VarChar(100)
  groupsIgnore    Boolean   @default(false) @db.Boolean
  alwaysOnline    Boolean   @default(false) @db.Boolean
  readMessages    Boolean   @default(false) @db.Boolean
  readStatus      Boolean   @default(false) @db.Boolean
  syncFullHistory Boolean   @default(false) @db.Boolean
  wavoipToken     String?   @db.VarChar(100)
  createdAt       DateTime? @default(now()) @db.Timestamp
  updatedAt       DateTime  @updatedAt @db.Timestamp
  Instance        Instance  @relation(fields: [instanceId], references: [id], onDelete: Cascade)
  instanceId      String    @unique

  @@index([instanceId])
  @@map("evo_Setting")
}

model Rabbitmq {
  id         String    @id @default(cuid())
  enabled    Boolean   @default(false) @db.Boolean
  events     Json      @db.JsonB
  createdAt  DateTime? @default(now()) @db.Timestamp
  updatedAt  DateTime  @updatedAt @db.Timestamp
  Instance   Instance  @relation(fields: [instanceId], references: [id], onDelete: Cascade)
  instanceId String    @unique

  @@map("evo_Rabbitmq")
}

model Nats {
  id         String    @id @default(cuid())
  enabled    Boolean   @default(false) @db.Boolean
  events     Json      @db.JsonB
  createdAt  DateTime? @default(now()) @db.Timestamp
  updatedAt  DateTime  @updatedAt @db.Timestamp
  Instance   Instance  @relation(fields: [instanceId], references: [id], onDelete: Cascade)
  instanceId String    @unique

  @@map("evo_Nats")
}

model Sqs {
  id         String    @id @default(cuid())
  enabled    Boolean   @default(false) @db.Boolean
  events     Json      @db.JsonB
  createdAt  DateTime? @default(now()) @db.Timestamp
  updatedAt  DateTime  @updatedAt @db.Timestamp
  Instance   Instance  @relation(fields: [instanceId], references: [id], onDelete: Cascade)
  instanceId String    @unique

  @@map("evo_Sqs")
}

model Kafka {
  id         String    @id @default(cuid())
  enabled    Boolean   @default(false) @db.Boolean
  events     Json      @db.JsonB
  createdAt  DateTime? @default(now()) @db.Timestamp
  updatedAt  DateTime  @updatedAt @db.Timestamp
  Instance   Instance  @relation(fields: [instanceId], references: [id], onDelete: Cascade)
  instanceId String    @unique

  @@map("evo_Kafka")
}

model Websocket {
  id         String    @id @default(cuid())
  enabled    Boolean   @default(false) @db.Boolean
  events     Json      @db.JsonB
  createdAt  DateTime? @default(now()) @db.Timestamp
  updatedAt  DateTime  @updatedAt @db.Timestamp
  Instance   Instance  @relation(fields: [instanceId], references: [id], onDelete: Cascade)
  instanceId String    @unique

  @@map("evo_Websocket")
}

model Pusher {
  id         String    @id @default(cuid())
  enabled    Boolean   @default(false) @db.Boolean
  appId      String    @db.VarChar(100)
  key        String    @db.VarChar(100)
  secret     String    @db.VarChar(100)
  cluster    String    @db.VarChar(100)
  useTLS     Boolean   @default(false) @db.Boolean
  events     Json      @db.JsonB
  createdAt  DateTime? @default(now()) @db.Timestamp
  updatedAt  DateTime  @updatedAt @db.Timestamp
  Instance   Instance  @relation(fields: [instanceId], references: [id], onDelete: Cascade)
  instanceId String    @unique

  @@map("evo_Pusher")
}

model Media {
  id         String    @id @default(cuid())
  fileName   String    @db.VarChar(500)
  type       String    @db.VarChar(100)
  mimetype   String    @db.VarChar(100)
  createdAt  DateTime? @default(now()) @db.Date
  Message    Message   @relation(fields: [messageId], references: [id], onDelete: Cascade)
  messageId  String    @unique
  Instance   Instance  @relation(fields: [instanceId], references: [id], onDelete: Cascade)
  instanceId String

  @@map("evo_Media")
}

model Template {
  id         String    @id @default(cuid())
  templateId String    @unique @db.VarChar(255)
  name       String    @unique @db.VarChar(255)
  template   Json      @db.JsonB
  webhookUrl String?   @db.VarChar(500)
  createdAt  DateTime? @default(now()) @db.Timestamp
  updatedAt  DateTime  @updatedAt @db.Timestamp
  Instance   Instance  @relation(fields: [instanceId], references: [id], onDelete: Cascade)
  instanceId String

  @@map("evo_Template")
}

model IsOnWhatsapp {
  id         String   @id @default(cuid())
  remoteJid  String   @unique @db.VarChar(100)
  jidOptions String
  lid        String?  @db.VarChar(100)
  createdAt  DateTime @default(now()) @db.Timestamp
  updatedAt  DateTime @updatedAt @db.Timestamp

  @@map("evo_IsOnWhatsapp")
}
